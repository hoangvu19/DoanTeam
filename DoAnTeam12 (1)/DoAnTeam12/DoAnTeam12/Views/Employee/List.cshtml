@model List<DoAnTeam12.Models.Employee.EmployeeModel>
@{
    ViewBag.Title = "List";
}

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11.7.3/dist/sweetalert2.min.css" />

<style>
    .employee-list-container {
        padding: 20px;
        font-family: sans-serif;
    }

    .employee-list-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
    }

    .employee-list-title {
        font-size: 24px;
        font-weight: bold;
        color: #333;
        margin-bottom: 10px;
    }

    .employee-list-divider {
        width: 100%;
        border-bottom: 1px solid #ddd;
        margin-bottom: 20px;
    }

    .add-employee-button {
        background-color: #28a745;
        color: white;
        padding: 10px 15px;
        border: none;
        border-radius: 5px;
        text-decoration: none;
        font-size: 16px;
        cursor: pointer;
        display: inline-flex;
        align-items: center;
    }

        .add-employee-button i {
            margin-right: 5px;
        }

    .employee-table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 20px;
    }

        .employee-table th,
        .employee-table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }

        .employee-table th {
            background-color: #f2f2f2;
            font-weight: bold;
        }

        .employee-table tbody tr:nth-child(even) {
            background-color: #f9f9f9;
        }

        .employee-table .action-buttons {
            display: flex;
            justify-content: center;
            gap: 10px;
        }

    .btn {
        display: inline-flex;
        align-items: center;
        padding: 8px 14px;
        border-radius: 5px;
        font-size: 14px;
        cursor: pointer;
        border: none;
        text-decoration: none;
        color: white;
        transition: background-color 0.3s ease;
        user-select: none;
    }

        .btn i {
            margin-right: 6px;
            font-size: 16px;
        }

    .btn-edit {
        background-color: #007bff;
    }

        .btn-edit:hover,
        .btn-edit:focus {
            background-color: #0056b3;
            outline: none;
        }

    .btn-delete {
        background-color: #dc3545;
    }

        .btn-delete:hover,
        .btn-delete:focus {
            background-color: #a71d2a;
            outline: none;
        }

    .search-container {
        display: flex;
        align-items: center;
    }

    .search-input {
        padding: 8px;
        border: 1px solid #ddd;
        border-radius: 4px;
        margin-right: 5px;
    }

    .search-button {
        background-color: #007bff;
        color: white;
        padding: 8px 12px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        display: inline-flex;
        align-items: center;
    }

        .search-button i {
            margin-right: 5px;
        }
</style>

<div class="employee-list-container">
    <h2 class="employee-list-title">Employee List</h2>
    <div class="employee-list-divider"></div>
    <div class="employee-list-header">
        <div class="search-container">
            @using (Html.BeginForm("List", "Employee", FormMethod.Get))
            {
                <input type="text" class="search-input" placeholder="Search by name or ID..." name="searchString" value="@ViewBag.SearchTerm" />
                <button type="submit" class="search-button">
                    <i class="bi bi-search"></i> Search
                </button>
            }
        </div>
        <a href="@Url.Action("Add", "Employee")" class="add-employee-button">
            <i class="bi bi-plus-circle"></i> Create New Employee
        </a>
    </div>

    <table class="employee-table">
        <thead>
            <tr>
                <th>Employee ID</th>
                <th>Full Name</th>
                <th>Date of Birth</th>
                <th>Gender</th>
                <th>Phone Number</th>
                <th>Email</th>
                <th>Hire Date</th>
                <th>Department</th>
                <th>Position</th>
                <th>Status</th>
                <th>Created At</th>
                <th>Updated At</th>
                <th class="text-center">Actions</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var nv in Model)
            {
                <tr id="row-@nv.EmployeeID">
                    <td>@nv.EmployeeID</td>
                    <td>@nv.FullName</td>
                    <td>@(nv.DateOfBirth.HasValue ? nv.DateOfBirth.Value.ToString("MM/dd/yyyy") : "N/A")</td>
                    <td>@nv.Gender</td>
                    <td>@nv.PhoneNumber</td>
                    <td>@nv.Email</td>
                    <td>@(nv.HireDate.HasValue ? nv.HireDate.Value.ToString("MM/dd/yyyy") : "N/A")</td>
                    <td>@nv.DepartmentName</td>
                    <td>@nv.PositionName</td>
                    <td>@nv.Status</td>
                    <td>@(nv.CreatedAt.HasValue ? nv.CreatedAt.Value.ToString("MM/dd/yyyy") : "N/A")</td>
                    <td>@(nv.UpdatedAt.HasValue ? nv.UpdatedAt.Value.ToString("MM/dd/yyyy") : "N/A")</td>
                    <td class="action-buttons">
                        <a href="@Url.Action("Edit", "Employee", new { id = nv.EmployeeID })" class="btn btn-edit" title="Edit">
                            <i class="bi bi-pencil"></i> Edit
                        </a>
                        <a href="javascript:void(0);" class="btn btn-delete btn-ajax-delete" data-id="@nv.EmployeeID" title="Delete">
                            <i class="bi bi-trash3"></i> Delete
                        </a>
                    </td>
                </tr>
            }
        </tbody>
    </table>
</div>

@section Scripts {
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.7.3/dist/sweetalert2.all.min.js"></script>

    <script>
        $(document).ready(function () {
            $(".btn-ajax-delete").click(function () {
                var id = $(this).data("id");
                var row = $("#row-" + id);

                Swal.fire({
                    title: 'Are you sure?',
                    text: "This action cannot be undone!",
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#d33',
                    cancelButtonColor: '#3085d6',
                    confirmButtonText: 'Yes, delete it!'
                }).then((result) => {
                    if (result.isConfirmed) {
                        $.ajax({
                            url: '@Url.Action("AjaxDelete", "Employee")',
                            type: 'POST',
                            data: { id: id },
                            success: function (response) {
                                if (response.success) {
                                    row.fadeOut(300, function () {
                                        $(this).remove();
                                    });
                                    Swal.fire(
                                        'Deleted!',
                                        'Employee has been deleted.',
                                        'success'
                                    );
                                } else {
                                    Swal.fire(
                                        'Error!',
                                        response.message,
                                        'error'
                                    );
                                }
                            },
                            error: function () {
                                Swal.fire(
                                    'Error!',
                                    'Could not connect to the server.',
                                    'error'
                                );
                            }
                        });
                    }
                });
            });
        });
    </script>
}
